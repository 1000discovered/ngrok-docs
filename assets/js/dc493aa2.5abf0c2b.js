"use strict";(self.webpackChunkngrok_doc=self.webpackChunkngrok_doc||[]).push([[55491],{68779:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>r,contentTitle:()=>l,default:()=>c,frontMatter:()=>s,metadata:()=>i,toc:()=>d});var n=a(51163),o=(a(59496),a(49613));const s={description:"How to use load balancer with ngrok cloud edge"},l="Load Balancing with ngrok Cloud Edges",i={unversionedId:"guides/load-balancing-with-cloud-edges",id:"guides/load-balancing-with-cloud-edges",title:"Load Balancing with ngrok Cloud Edges",description:"How to use load balancer with ngrok cloud edge",source:"@site/docs/guides/load-balancing-with-cloud-edges.md",sourceDirName:"guides",slug:"/guides/load-balancing-with-cloud-edges",permalink:"/docs/guides/load-balancing-with-cloud-edges",draft:!1,editUrl:"https://github.com/ngrok/ngrok-docs/edit/main/docs/guides/load-balancing-with-cloud-edges.md",tags:[],version:"current",lastUpdatedBy:"Russ Savage",lastUpdatedAt:1691862991,formattedLastUpdatedAt:"Aug 12, 2023",frontMatter:{description:"How to use load balancer with ngrok cloud edge"},sidebar:"docs",previous:{title:"How to set up a custom domain",permalink:"/docs/guides/how-to-set-up-a-custom-domain"},next:{title:"Corporate Firewall",permalink:"/docs/guides/running-behind-firewalls"}},r={},d=[{value:"Setting up an HTTPS Edge",id:"setting-up-an-https-edge",level:3},{value:"Starting your ngrok Agent Tunnels",id:"starting-your-ngrok-agent-tunnels",level:3},{value:"Next Steps",id:"next-steps",level:3}],u={toc:d},g="wrapper";function c(e){let{components:t,...s}=e;return(0,o.kt)(g,(0,n.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"load-balancing-with-ngrok-cloud-edges"},"Load Balancing with ngrok Cloud Edges"),(0,o.kt)("hr",null),(0,o.kt)("p",null,"This guide will walk you through the process of configuring load balancing on your HTTPS edge. For completing this guide, you will need an ngrok account, and upstream service deployed across multiple machines that you would like to load balance requests to, and the latest ngrok agent installed on each of those machines."),(0,o.kt)("h3",{id:"setting-up-an-https-edge"},"Setting up an HTTPS Edge"),(0,o.kt)("p",null,"Once you have your ",(0,o.kt)("a",{parentName:"p",href:"https://dashboard.ngrok.com"},"ngrok account"),", open up the ngrok dashboard and navigate to the ",(0,o.kt)("a",{parentName:"p",href:"https://dashboard.ngrok.com/cloud-edge/edges"},"Cloud Edges page"),'. Click the "+ New Edge" button and select an HTTPS Edge. Doing this will create everything you need to start load balancing traffic to your upstream service. You now have a new HTTPS edge for serving web traffic, a public URL for accessing that traffic, and a default failover backend.'),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/cloud-edge/edges/#backends"},"Backends")," tell an edge how to handle traffic that is sent to its endpoints. A failover backend allows you to specify an ordered list of other backends to try. The default failover backend for this edge includes a tunnel group backend and a static 404 page to failover to. A tunnel group backend is what will provide the load balancing of requests across multiple ngrok agents."),(0,o.kt)("p",null,"Clicking the endpoint that was created when making this edge should open a new page and display a 404 page. This makes sense because we haven't started any tunnels for the tunnel group backend to serve traffic to."),(0,o.kt)("p",null,(0,o.kt)("img",{src:a(86778).Z,width:"1982",height:"1110"})),(0,o.kt)("h3",{id:"starting-your-ngrok-agent-tunnels"},"Starting your ngrok Agent Tunnels"),(0,o.kt)("p",null,'Now let\'s start a tunnel to send traffic to your upstream service. You can click the "Start a Tunnel" button on this error page or look in the "Status" area of the HTTPS edge. Clicking this button will open a drawer with instructions on how to install and configure your agent.'),(0,o.kt)("p",null,"The command for starting the tunnel in the ngrok agent should look something like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"ngrok tunnel 80 --region us --label edge=edghts_27RM7TKmP9FbDTFjT1uJuIyBgRk\n")),(0,o.kt)("p",null,"This assumes your upstream service is running on port 80 and in the US region. If your upstream service is on a different port or running in a different region, just update those values in the ",(0,o.kt)("inlineCode",{parentName:"p"},"ngrok tunnel")," command."),(0,o.kt)("p",null,"Tunnel group backends work by looking for ngrok agents that are serving tunnels with a specific ",(0,o.kt)("a",{parentName:"p",href:"/cloud-edge/edges/#tunnel-group-labels"},"set of labels"),". By default, the label for this tunnel group is the ID of the HTTPS edge that was created, but you can use the ",(0,o.kt)("a",{parentName:"p",href:"/api/resources/tunnel-group-backends#update-tunnel-group-backend"},"API to customize those labels")," to something that makes sense for your service. For example, you might use labels that help identify the region and service you are attempting to load balance."),(0,o.kt)("p",null,"On each of the machines that are running your upstream service, you should start an ngrok agent with the specific label for this HTTPS edge. You can start as many as you want. Once started, you should be able to see the agents in the HTTPS edge page in the dashboard (you might have to click refresh). Traffic will now be routed round robin to each of the agents with a tunnel that matches the labels of the tunnel group backend."),(0,o.kt)("p",null,(0,o.kt)("img",{src:a(35967).Z,width:"1350",height:"566"})),(0,o.kt)("h3",{id:"next-steps"},"Next Steps"),(0,o.kt)("p",null,"That's all there is to it. You now have multiple ngrok agents load balancing traffic to your upstream service. Now that you have an HTTPS edge configured, check out these next steps:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/cloud-edge/edges/https#https-edge-routes"},"HTTPS Edge Routes")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/cloud-edge/edges/https#https-edge-modules"},"HTTPS Edge Modules")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/cloud-edge/endpoints"},"Endpoints")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/guides/securing-your-tunnels"},"Securing your ngrok Tunnels"))))}c.isMDXComponent=!0},86778:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/default-edge-404-page-8a6a3f131bafbdb05b3214e14a29e6d4.png"},35967:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/https-edge-three-tunnels-b38130176f2a98d44833c9e794066501.png"}}]);