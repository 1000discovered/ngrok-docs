"use strict";(self.webpackChunkngrok_doc=self.webpackChunkngrok_doc||[]).push([[21726],{21455:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var n=a(51163),o=(a(59496),a(49613));const r={description:"Use Microsoft Azure AD B2C to secure access to ngrok tunnels"},i="Azure Active Directory B2C SSO (SAML)",l={unversionedId:"integrations/azure-ad-b2c/sso-saml",id:"integrations/azure-ad-b2c/sso-saml",title:"Azure Active Directory B2C SSO (SAML)",description:"Use Microsoft Azure AD B2C to secure access to ngrok tunnels",source:"@site/docs/integrations/azure-ad-b2c/sso-saml.md",sourceDirName:"integrations/azure-ad-b2c",slug:"/integrations/azure-ad-b2c/sso-saml",permalink:"/docs/integrations/azure-ad-b2c/sso-saml",draft:!1,editUrl:"https://github.com/ngrok/ngrok-docs/edit/main/docs/integrations/azure-ad-b2c/sso-saml.md",tags:[],version:"current",lastUpdatedBy:"Russ Savage",lastUpdatedAt:1693002758,formattedLastUpdatedAt:"Aug 25, 2023",frontMatter:{description:"Use Microsoft Azure AD B2C to secure access to ngrok tunnels"},sidebar:"docs",previous:{title:"Azure AD B2C",permalink:"/docs/integrations/azure-ad-b2c/"},next:{title:"Bitbucket",permalink:"/docs/integrations/bitbucket/"}},s={},p=[{value:"Requirements",id:"requirements",level:2},{value:"Step 1: Create an ngrok Edge",id:"create-edge",level:2},{value:"Step 2: Configure Azure AD B2C custom policies",id:"create-policies",level:2},{value:"Step 3: Create an Azure AD B2C SAML application",id:"create-app",level:2},{value:"Step 4: Update the ngrok Edge with the IdP metadata",id:"update-ngrok-edge",level:2},{value:"Step 5: Test the integration",id:"test-integration",level:2},{value:"Bonus: Update your Azure AD B2C custom policies to support the password reset flow",id:"bonus",level:2}],c={toc:p},m="wrapper";function d(e){let{components:t,...r}=e;return(0,o.kt)(m,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"azure-active-directory-b2c-sso-saml"},"Azure Active Directory B2C SSO (SAML)"),(0,o.kt)("hr",null),(0,o.kt)("admonition",{title:"TL;DR",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"To have ngrok enforce Single Sign-On using SAML with Azure Active Directory B2C (Azure AD B2C):"),(0,o.kt)("ol",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#create-edge"},"Create an ngrok Edge")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#create-policies"},"Configure Azure AD B2C custom policies")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#create-app"},"Create an Azure AD B2C SAML application")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#update-ngrok-edge"},"Update the ngrok Edge with the IdP metadata")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#test-integration"},"Test your integration")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#bonus"},"Bonus: Update your Azure AD B2C custom policies to support the password reset flow")))),(0,o.kt)("p",null,"This article details how to configure Azure AD B2C as an Identity Provider for your ngrok Edge. By integrating Azure AD B2C with ngrok, you can:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Restrict access to ngrok tunnels to only users who authenticated via Azure AD B2C"),(0,o.kt)("li",{parentName:"ul"},"Allow users to authenticate via a local account or federated accounts via Azure AD B2C")),(0,o.kt)("h2",{id:"requirements"},"Requirements"),(0,o.kt)("p",null,"To configure ngrok tunnels with Azure AD B2C, you must have:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"an ",(0,o.kt)("a",{parentName:"li",href:"https://ngrok.com/pricing"},"ngrok Enterprise Account")," with an authtoken or admin access to configure edges with SAML"),(0,o.kt)("li",{parentName:"ul"},"a Microsoft Azure account with access to an Azure AD B2C tenant"),(0,o.kt)("li",{parentName:"ul"},"an understanding of Azure AD B2C ",(0,o.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/active-directory-b2c/custom-policy-overview"},"custom policies"))),(0,o.kt)("h2",{id:"create-edge"},"Step 1: Create an ngrok Edge"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Go to the ",(0,o.kt)("a",{parentName:"p",href:"https://dashboard.ngrok.com"},"ngrok dashboard"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Click ",(0,o.kt)("strong",{parentName:"p"},"Cloud Edge")," > ",(0,o.kt)("strong",{parentName:"p"},"Edges"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create an Edge:"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Click ",(0,o.kt)("strong",{parentName:"li"},"New Edge")),(0,o.kt)("li",{parentName:"ol"},"Click ",(0,o.kt)("strong",{parentName:"li"},"HTTPS Edge")),(0,o.kt)("li",{parentName:"ol"},"Click the ",(0,o.kt)("strong",{parentName:"li"},"Pencil Icon"),' next to "no description". Enter ',(0,o.kt)("em",{parentName:"li"},"Edge With Azure Active Directory B2C SSO")," as the Edge name and click ",(0,o.kt)("strong",{parentName:"li"},"Save")))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Configure the SAML module for this Edge:"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"On the Routes section, click ",(0,o.kt)("strong",{parentName:"li"},"SAML")),(0,o.kt)("li",{parentName:"ol"},"Click ",(0,o.kt)("strong",{parentName:"li"},"Begin setup")),(0,o.kt)("li",{parentName:"ol"},"In the Identity Provider section, copy the following XML as a placeholder into the input box")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<EntityDescriptor xmlns="urn:oasis:names:tc:SAML:2.0:metadata"></EntityDescriptor>\n')),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img/1-3.png",src:a(37490).Z,width:"1916",height:"2244"})),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Click ",(0,o.kt)("strong",{parentName:"p"},"Save"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Note that ngrok has now generated values for the fields in the Service Provider section. We will use these to configure Azure AD B2C later"))))),(0,o.kt)("h2",{id:"create-policies"},"Step 2: Configure Azure AD B2C custom policies"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Follow the directions based on the ",(0,o.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/active-directory-b2c/tutorial-create-user-flows?pivots=b2c-custom-policy"},"Azure docs"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Some hints"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"For a SAML application, you need to configure custom policies as it is not possible to use the user flows, as noted elsewhere in the ",(0,o.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/active-directory-b2c/saml-service-provider?tabs=macos&pivots=b2c-user-flow#register-your-saml-application-in-azure-ad-b2c"},"Azure docs")),(0,o.kt)("li",{parentName:"ol"},"A couple resources to make the process of following these steps easier: you can follow along the docs with the templates shared in ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack"},"Azure AD B2C custom policy starterpack"),", or you can to use the ",(0,o.kt)("a",{parentName:"li",href:"https://b2ciefsetupapp.azurewebsites.net"},"IEF Setup App")," to automate these steps"),(0,o.kt)("li",{parentName:"ol"},"To keep things simple, use the ",(0,o.kt)("inlineCode",{parentName:"li"},"LocalAccounts")," starter pack. This means users will sign up and log in as users in your Azure AD B2C tenant vs. with another identity provider This means you can skip configuring Facebook as an identity provider. If you are using the IEF Setup App, click the checkbox for ",(0,o.kt)("inlineCode",{parentName:"li"},"Remove Facebook references")," before you deploy the starter pack"),(0,o.kt)("li",{parentName:"ol"},"Skip the steps of ",(0,o.kt)("inlineCode",{parentName:"li"},"Register a web application")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"Enable ID token implicit grant")," unless you'd like to test this now. We will register a SAML application and test it later")))),(0,o.kt)("h2",{id:"create-app"},"Step 3: Create an Azure AD B2C SAML application"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Follow the directions based on the ",(0,o.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/active-directory-b2c/saml-service-provider?tabs=windows&pivots=b2c-custom-policy"},"Azure docs"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Some hints"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Update your previously created custom policies to use SAML. You can either update the files in the starterpack repo, or you can download the XML files for your existing policies from the ",(0,o.kt)("a",{parentName:"li",href:"https://portal.azure.com/#view/Microsoft_AAD_B2CAdmin/CustomPoliciesMenuBlade/~/overview/tenantId/ngroksaml.onmicrosoft.com"},"Identity Experience Framework page")),(0,o.kt)("li",{parentName:"ol"},"If you are using the ",(0,o.kt)("inlineCode",{parentName:"li"},"LocalAccounts")," starter pack, remember to adjust the orchestration step order value to ",(0,o.kt)("inlineCode",{parentName:"li"},"4")," as noted in these docs"),(0,o.kt)("li",{parentName:"ol"},"Use the following mapping of Azure AD B2C configuration properties to ngrok generated values (found in your Edge's SAML configuration in the Service Provider section) to configure your application")),(0,o.kt)("table",{parentName:"li"},(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Azure AD B2C"),(0,o.kt)("th",{parentName:"tr",align:null},"ngrok"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"RedirectURI")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"ACS URL"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"identifierUri")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"EntityID"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"samlMetadataUrl")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"SP Metadata"))))),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img/3-2.png",src:a(79769).Z,width:"1918",height:"2142"})),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img/3-2b.png",src:a(57020).Z,width:"1922",height:"2142"})))),(0,o.kt)("h2",{id:"update-ngrok-edge"},"Step 4: Update the ngrok Edge with the IdP metadata"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Back in the ngrok dashboard for your Edge's SAML configuration, copy and paste the XML found at the IdP Saml Metadata URL in the Identity Provider section, replacing the previously set placeholder value. Note the IdP Metadata URL follows this format: ",(0,o.kt)("inlineCode",{parentName:"p"},"https://<tenant-name>.b2clogin.com/<tenant-name>.onmicrosoft.com/<policy-name>/Samlp/metadata"),"."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img/4-1.png",src:a(34091).Z,width:"1918",height:"2242"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Click ",(0,o.kt)("strong",{parentName:"p"},"Save")))),(0,o.kt)("h2",{id:"test-integration"},"Step 5: Test the integration"),(0,o.kt)("admonition",{title:"Note",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"For this step, we assume you have an app running locally (i.e. on localhost:3000) with the ngrok client installed.")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Launch a tunnel connected to your configured Edge")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"On your Edge's page, in the Routes section, click ",(0,o.kt)("strong",{parentName:"p"},"Start a tunnel")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img/5-1.png",src:a(5102).Z,width:"1910",height:"2244"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Copy the tunnel command"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img/5-1b.png",src:a(39130).Z,width:"1916",height:"2244"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Launch a terminal and paste the command, replacing ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:80")," with your local web app address (e.g., ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:3000"),")")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Hit ",(0,o.kt)("strong",{parentName:"p"},"Enter")," to launch the tunnel")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Confirm that the tunnel is connected to your edge"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Return to the ngrok dashboard"),(0,o.kt)("li",{parentName:"ol"},"Close the ",(0,o.kt)("strong",{parentName:"li"},"Start a tunnel")," and the ",(0,o.kt)("strong",{parentName:"li"},"Tunnel group")," drawers"),(0,o.kt)("li",{parentName:"ol"},"Refresh the Edge page"),(0,o.kt)("li",{parentName:"ol"},"In the Routes section > Traffic section you will see the message ",(0,o.kt)("em",{parentName:"li"},"You have 1 tunnel online. Start additional tunnels to begin load balancing."))),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img/5-2.png",src:a(58221).Z,width:"1912",height:"2250"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Copy the ngrok url on the Endpoints section")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Access your Edge application"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"In your browser, launch an incognito window"),(0,o.kt)("li",{parentName:"ol"},"Access your ngrok tunnel via your copied URL"),(0,o.kt)("li",{parentName:"ol"},"You should be prompted to log in or sign up")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img/5-3.png",src:a(22031).Z,width:"1920",height:"2196"})),(0,o.kt)("ol",{parentName:"li",start:4},(0,o.kt)("li",{parentName:"ol"},"After login, you should be able to see the application")))),(0,o.kt)("h2",{id:"bonus"},"Bonus: Update your Azure AD B2C custom policies to support the password reset flow"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"From the test, you may notice that the ",(0,o.kt)("inlineCode",{parentName:"li"},"Forgot your password?")," link doesn't work. You will need to embed the password reset flow as part of your sign up / sign in custom policy for local accounts, as the ",(0,o.kt)("inlineCode",{parentName:"li"},"LocalAccounts")," starter pack did not include this flow as part of the sign up / sign in policy. Here is ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/azure-ad-b2c/samples/tree/master/policies/embedded-password-reset"},"sample code from Azure AD B2C")," on how to configure this")))}d.isMDXComponent=!0},37490:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/1-3-6bd04556024699a2ee588a548aeb25c2.png"},79769:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/3-2-a8e14243c519cdcc96a4b2f2df4eb473.png"},57020:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/3-2b-d73381fdee6b30e124fd428e6a22c18d.png"},34091:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/4-1-44415653d8d4cbf2443b78cdbf563add.png"},5102:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/5-1-3268c7a050c455af4b39eb2adb5b9e37.png"},39130:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/5-1b-a260f2c29d31d0328140ac41e98a40f8.png"},58221:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/5-2-5dd63bcab70c427018d680c6f0993e16.png"},22031:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/5-3-2f808888cfa2b2c3334cbb5a0ecd8f25.png"}}]);