"use strict";(self.webpackChunkngrok_doc=self.webpackChunkngrok_doc||[]).push([[99207],{41822:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>n,metadata:()=>l,toc:()=>s});var o=r(51163),a=(r(59496),r(49613));const n={},i="User Agent Filter",l={unversionedId:"cloud-edge/modules/user-agent-filter",id:"cloud-edge/modules/user-agent-filter",title:"User Agent Filter",description:"---",source:"@site/docs/cloud-edge/modules/user-agent-filter.md",sourceDirName:"cloud-edge/modules",slug:"/cloud-edge/modules/user-agent-filter",permalink:"/docs/cloud-edge/modules/user-agent-filter",draft:!1,editUrl:"https://github.com/ngrok/ngrok-docs/edit/main/docs/cloud-edge/modules/user-agent-filter.md",tags:[],version:"current",lastUpdatedBy:"Mohamed Osman Ahmed",lastUpdatedAt:1694021415,formattedLastUpdatedAt:"Sep 6, 2023",frontMatter:{},sidebar:"docs",previous:{title:"TLS Termination",permalink:"/docs/cloud-edge/modules/tls-termination"},next:{title:"Webhook Verification",permalink:"/docs/cloud-edge/modules/webhook-verification"}},d={},s=[{value:"Overview",id:"overview",level:2},{value:"Quickstart",id:"quickstart",level:2},{value:"Agent CLI",id:"agent-cli",level:3},{value:"SSH",id:"ssh",level:3},{value:"Agent Configuration File",id:"agent-configuration-file",level:3},{value:"Go SDK",id:"go-sdk",level:3},{value:"Behavior",id:"behavior",level:2},{value:"Rule Evaluation",id:"rule-evaluation",level:3},{value:"Internal Deny List",id:"internal-deny-list",level:3},{value:"Reference",id:"reference",level:2},{value:"Configuration",id:"configuration",level:3},{value:"<strong>Agent Configuration</strong>",id:"agent-configuration",level:6},{value:"Upstream Headers",id:"upstream-headers",level:3},{value:"Errors",id:"errors",level:3},{value:"Limits",id:"limits",level:3},{value:"Try it out",id:"try-it-out",level:2}],u={toc:s},c="wrapper";function p(e){let{components:t,...r}=e;return(0,a.kt)(c,(0,o.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"user-agent-filter"},"User Agent Filter"),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"The User Agent Filter module allows you to allow or deny traffic based on the request's User-Agent header sent to your HTTP endpoint."),(0,a.kt)("p",null,"A request is allowed if it's User-Agent header matches an allow rule or does not match any rule. A request is denied when it's User-Agent header matches a deny rule."),(0,a.kt)("h2",{id:"quickstart"},"Quickstart"),(0,a.kt)("h3",{id:"agent-cli"},"Agent CLI"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'ngrok http 80 --ua-filter-allow="(foo/(\\d)+.(\\d)+)","(bar/(\\d)+.(\\d)+)" --ua-filter-deny="(buz/(\\d)+.(\\d)+)"\n')),(0,a.kt)("h3",{id:"ssh"},"SSH"),(0,a.kt)("p",null,'``bash\nssh -R 443:localhost:80 connect.ngrok-agent.com http \\\n--ua-filter-allow="(foo/(\\d)+.(\\d)+)" \\\n--ua-filter-deny="(bar/(\\d)+.(\\d)+)" \\'),(0,a.kt)("h3",{id:"agent-configuration-file"},"Agent Configuration File"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'\n```yaml\ntunnels:\n  example:\n    proto: https\n    addr: 80\n    ua_filter_allow: ["(foo/(\\d)+.(\\d)+)", "(bar/(\\d)+.(\\d)+)"]\n    ua_filter_deny: ["(buzz/(\\d)+.(\\d)+)"]\n')),(0,a.kt)("h3",{id:"go-sdk"},"Go SDK"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n    "context"\n    "net"\n\n    "golang.ngrok.com/ngrok"\n    "golang.ngrok.com/ngrok/config"\n)\n\nfunc listenUserAgentFIlter(ctx context.Context) net.Listener {\n    listener, _ := ngrok.Listen(ctx,\n        config.HTTPEndpoint(\n            config.WithUserAgentFilter( []string{"(foo)/(\\d)+.(\\d)+"}, []string{"bar/(\\d)+.(\\d)+"}),\n        ),\n        ngrok.WithAuthtokenFromEnv(),\n    )\n    return listener\n}\n')),(0,a.kt)("h2",{id:"behavior"},"Behavior"),(0,a.kt)("h3",{id:"rule-evaluation"},"Rule Evaluation"),(0,a.kt)("p",null,"A connection is allowed only if its User-Agent header matches at least one rule in the allow list or matches nothing in either rule list. A connection is denied if it's User-Agent header is either empty, matches your defined deny rules, or matches our internal deny rules."),(0,a.kt)("h3",{id:"internal-deny-list"},"Internal Deny List"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-Go"},"    `(Pingdom\\.com_bot_version_)(\\d+)\\.(\\d+)`, // Pingdom\n    `(facebookexternalhit)/(\\d+)\\.(\\d+)`, // Facebook\n    `Google.*/\\+/web/snippet`,            // Google Plus\n    `(Twitterbot)/(\\d+)\\.(\\d+)`,          // Twitter\n    `\\b(Boto3?|JetS3t|aws-(?:cli|sdk-(?:cpp|go|java|nodejs|ruby2?|dotnet-(?:\\d{1,2}|core)))|s3fs)/(\\d+)\\.(\\d+)(?:\\.(\\d+)|)`, // AWS S3 Clients\n    ` PTST/\\d+(?:\\.)?\\d+$`, // PTST / WebPageTest.org crawlers\n    `/((?:Ant-)?Nutch|[A-z]+[Bb]ot|[A-z]+[Ss]pider|Axtaris|fetchurl|Isara|ShopSalad|Tailsweep)[ \\-](\\d+)(?:\\.(\\d+)(?:\\.(\\d+))?)?`,                                                                                                                                                                 // Bots Pattern '/name-0.0'\n    `\\b(008|Altresium|Argus|BaiduMobaider|BoardReader|DNSGroup|DataparkSearch|EDI|Goodzer|Grub|INGRID|Infohelfer|LinkedInBot|LOOQ|Nutch|OgScrper|PathDefender|Peew|PostPost|Steeler|Twitterbot|VSE|WebCrunch|WebZIP|Y!J-BR[A-Z]|YahooSeeker|envolk|sproose|wminer)/(\\d+)(?:\\.(\\d+)|)(?:\\.(\\d+)|)`, //Bots Pattern 'name/0.0'\n    `(MSIE) (\\d+)\\.(\\d+)([a-z]\\d|[a-z]|);.* MSIECrawler`, //MSIECrawler\n    `(Google-HTTP-Java-Client|Apache-HttpClient|Go-http-client|scalaj-http|http%20client|Python-urllib|HttpMonitor|TLSProber|WinHTTP|JNLP|okhttp|aihttp|reqwest|axios|unirest-(?:java|python|ruby|nodejs|php|net))(?:[ /](\\d+)(?:\\.(\\d+)|)(?:\\.(\\d+)|)|)`, // Downloader ...\n    `(CSimpleSpider|Cityreview Robot|CrawlDaddy|CrawlFire|Finderbots|Index crawler|Job Roboter|KiwiStatus Spider|Lijit Crawler|QuerySeekerSpider|ScollSpider|Trends Crawler|USyd-NLP-Spider|SiteCat Webbot|BotName\\/\\$BotVersion|123metaspider-Bot|1470\\.net crawler|50\\.nu|8bo Crawler Bot|Aboundex|Accoona-[A-z]{1,30}-Agent|AdsBot-Google(?:-[a-z]{1,30}|)|altavista|AppEngine-Google|archive.{0,30}\\.org_bot|archiver|Ask Jeeves|[Bb]ai[Dd]u[Ss]pider(?:-[A-Za-z]{1,30})(?:-[A-Za-z]{1,30}|)|bingbot|BingPreview|blitzbot|BlogBridge|Bloglovin|BoardReader Blog Indexer|BoardReader Favicon Fetcher|boitho.com-dc|BotSeer|BUbiNG|\\b\\w{0,30}favicon\\w{0,30}\\b|\\bYeti(?:-[a-z]{1,30}|)|Catchpoint(?: bot|)|[Cc]harlotte|Checklinks|clumboot|Comodo HTTP\\(S\\) Crawler|Comodo-Webinspector-Crawler|ConveraCrawler|CRAWL-E|CrawlConvera|Daumoa(?:-feedfetcher|)|Feed Seeker Bot|Feedbin|findlinks|Flamingo_SearchEngine|FollowSite Bot|furlbot|Genieo|gigabot|GomezAgent|gonzo1|(?:[a-zA-Z]{1,30}-|)Googlebot(?:-[a-zA-Z]{1,30}|)|Google SketchUp|grub-client|gsa-crawler|heritrix|HiddenMarket|holmes|HooWWWer|htdig|ia_archiver|ICC-Crawler|Icarus6j|ichiro(?:/mobile|)|IconSurf|IlTrovatore(?:-Setaccio|)|InfuzApp|Innovazion Crawler|InternetArchive|IP2[a-z]{1,30}Bot|jbot\\b|KaloogaBot|Kraken|Kurzor|larbin|LEIA|LesnikBot|Linguee Bot|LinkAider|LinkedInBot|Lite Bot|Llaut|lycos|Mail\\.RU_Bot|masscan|masidani_bot|Mediapartners-Google|Microsoft .{0,30} Bot|mogimogi|mozDex|MJ12bot|msnbot(?:-media {0,2}|)|msrbot|Mtps Feed Aggregation System|netresearch|Netvibes|NewsGator[^/]{0,30}|^NING|Nutch[^/]{0,30}|Nymesis|ObjectsSearch|OgScrper|Orbiter|OOZBOT|PagePeeker|PagesInventory|PaxleFramework|Peeplo Screenshot Bot|PlantyNet_WebRobot|Pompos|Qwantify|Read%20Later|Reaper|RedCarpet|Retreiver|Riddler|Rival IQ|scooter|Scrapy|Scrubby|searchsight|seekbot|semanticdiscovery|SemrushBot|Simpy|SimplePie|SEOstats|SimpleRSS|SiteCon|Slackbot-LinkExpanding|Slack-ImgProxy|Slurp|snappy|Speedy Spider|Squrl Java|Stringer|TheUsefulbot|ThumbShotsBot|Thumbshots\\.ru|Tiny Tiny RSS|Twitterbot|WhatsApp|URL2PNG|Vagabondo|VoilaBot|^vortex|Votay bot|^voyager|WASALive.Bot|Web-sniffer|WebThumb|WeSEE:[A-z]{1,30}|WhatWeb|WIRE|WordPress|Wotbox|www\\.almaden\\.ibm\\.com|Xenu(?:.s|) Link Sleuth|Xerka [A-z]{1,30}Bot|yacy(?:bot|)|YahooSeeker|Yahoo! Slurp|Yandex\\w{1,30}|YodaoBot(?:-[A-z]{1,30}|)|YottaaMonitor|Yowedo|^Zao|^Zao-Crawler|ZeBot_www\\.ze\\.bz|ZooShot|ZyBorg)(?:[ /]v?(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)|)|)|)`, // Bots\n    `(?:\\/[A-Za-z0-9\\.]+|) {0,5}([A-Za-z0-9 \\-_\\!\\[\\]:]{0,50}(?:[Aa]rchiver|[Ii]ndexer|[Ss]craper|[Bb]ot|[Ss]pider|[Cc]rawl[a-z]{0,50}))[/ ](\\d+)(?:\\.(\\d+)(?:\\.(\\d+)|)|)`,  // Bots General matcher 'name/0.0'\n    `(?:\\/[A-Za-z0-9\\.]+|) {0,5}([A-Za-z0-9 \\-_\\!\\[\\]:]{0,50}(?:[Aa]rchiver|[Ii]ndexer|[Ss]craper|[Bb]ot|[Ss]pider|[Cc]rawl[a-z]{0,50})) (\\d+)(?:\\.(\\d+)(?:\\.(\\d+)|)|)`,     // Bots General matcher 'name 0.0'\n    `((?:[A-z0-9]{1,50}|[A-z\\-]{1,50} ?|)(?: the |)(?:[Ss][Pp][Ii][Dd][Ee][Rr]|[Ss]crape|[Cc][Rr][Aa][Ww][Ll])[A-z0-9]{0,50})(?:(?:[ /]| v)(\\d+)(?:\\.(\\d+)|)(?:\\.(\\d+)|)|)`, // Bots containing spider|scrape|bot(but not CUBOT)|Crawl\n")),(0,a.kt)("h2",{id:"reference"},"Reference"),(0,a.kt)("h3",{id:"configuration"},"Configuration"),(0,a.kt)("h6",{id:"agent-configuration"},(0,a.kt)("strong",{parentName:"h6"},"Agent Configuration")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},"User Agent Filter Allow")),(0,a.kt)("td",{parentName:"tr",align:null},"A set of regular expressions used to match allow User-Agents.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},"User Agent Filter Deny")),(0,a.kt)("td",{parentName:"tr",align:null},"A set of regular expressions used to match deny User-Agents.")))),(0,a.kt)("h3",{id:"upstream-headers"},"Upstream Headers"),(0,a.kt)("p",null,"This module does not add any upstream headers."),(0,a.kt)("h3",{id:"errors"},"Errors"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Code"),(0,a.kt)("th",{parentName:"tr",align:null},"HTTP Status"),(0,a.kt)("th",{parentName:"tr",align:null},"Error"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"/errors/err_ngrok_3211/"},"ERR_NGROK_3211")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"403")),(0,a.kt)("td",{parentName:"tr",align:null},"The server does not authorize requests from your user-agent")))),(0,a.kt)("h3",{id:"limits"},"Limits"),(0,a.kt)("p",null,"TODO:"),(0,a.kt)("h2",{id:"try-it-out"},"Try it out"),(0,a.kt)("p",null,"Run ngrok with User Agent Filter's allow and deny set to the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'ngrok http 80 \\\n  --domain your-domain.ngrok.app \\\n  --ua-filter-allow="(GoingMerry/(\\d)+.(\\d)+)","(GomuGomu/(\\d)+.(\\d)+)" \\\n  --ua-filter-deny="(Xebec/(\\d)+.(\\d)+)"\n')),(0,a.kt)("p",null,"Then make requests to your ngrok domain with the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"curl --location https://your-domain.ngrok.app -H 'Content-Type: text/plain' -A 'GoingMerry/1.1' --data 'https://www.youtube.com/watch?v=djyTG19Achg' -k -v\ncurl --location https://your-domain.ngrok.app -H 'Content-Type: text/plain' -A 'GomuGomu/1.1' --data 'https://www.youtube.com/watch?v=djyTG19Achg' -k -v\ncurl --location https://your-domain.ngrok.app -H 'Content-Type: text/plain' -A 'Xebec/1.1' --data 'https://www.youtube.com/watch?v=djyTG19Achg' -k -v\ncurl --location https://your-domain.ngrok.app -H 'Content-Type: text/plain' -A '' --data 'https://www.youtube.com/watch?v=djyTG19Achg' -k -v\ncurl --location https://your-domain.ngrok.app -H 'Content-Type: text/plain' -A 'TwitterBot/1.1' --data 'https://www.youtube.com/watch?v=djyTG19Achg' -k -v\n")))}p.isMDXComponent=!0}}]);