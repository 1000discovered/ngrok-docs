"use strict";(self.webpackChunkngrok_doc=self.webpackChunkngrok_doc||[]).push([[49437],{70900:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>c,frontMatter:()=>l,metadata:()=>i,toc:()=>o});var a=n(51163),r=(n(59496),n(49613));const l={sidebar_position:4,title:"Agent API",toc_max_heading_level:2},s="ngrok Agent API",i={unversionedId:"secure-tunnels/ngrok-agent/reference/api",id:"secure-tunnels/ngrok-agent/reference/api",title:"Agent API",description:"---",source:"@site/docs/secure-tunnels/ngrok-agent/reference/api.md",sourceDirName:"secure-tunnels/ngrok-agent/reference",slug:"/secure-tunnels/ngrok-agent/reference/api",permalink:"/docs/secure-tunnels/ngrok-agent/reference/api",draft:!1,editUrl:"https://github.com/ngrok/ngrok-docs/edit/main/docs/secure-tunnels/ngrok-agent/reference/api.md",tags:[],version:"current",lastUpdatedBy:"Russ Savage",lastUpdatedAt:1691862991,formattedLastUpdatedAt:"Aug 12, 2023",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"Agent API",toc_max_heading_level:2},sidebar:"docs",previous:{title:"Agent CLI",permalink:"/docs/secure-tunnels/ngrok-agent/reference/ngrok"},next:{title:"Agent Changelog",permalink:"/docs/secure-tunnels/ngrok-agent/reference/changelog"}},p={},o=[{value:"Base URL and Authentication",id:"base-url-and-authentication",level:2},{value:"Access the root API resource of a running ngrok agent",id:"access-the-root-api-resource-of-a-running-ngrok-agent",level:3},{value:"Supported Content Types",id:"supported-content-types",level:2},{value:"Versioning and API Stability",id:"versioning-and-api-stability",level:2},{value:"List Tunnels",id:"list-tunnels",level:2},{value:"Request",id:"request",level:3},{value:"Response",id:"response",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Example Response",id:"example-response",level:3},{value:"Start tunnel",id:"start-tunnel",level:2},{value:"Request",id:"request-1",level:3},{value:"Parameters",id:"parameters-1",level:3},{value:"Example request body",id:"example-request-body",level:3},{value:"Response",id:"response-1",level:3},{value:"Example Response",id:"example-response-1",level:3},{value:"Tunnel detail",id:"tunnel-detail",level:2},{value:"Request",id:"request-2",level:3},{value:"Response",id:"response-2",level:3},{value:"Example Response",id:"example-response-2",level:3},{value:"Stop tunnel",id:"stop-tunnel",level:2},{value:"Request",id:"request-3",level:3},{value:"Response",id:"response-3",level:3},{value:"List Captured Requests",id:"list-captured-requests",level:2},{value:"Request",id:"request-4",level:3},{value:"Query Parameters",id:"query-parameters",level:3},{value:"Example Request",id:"example-request",level:3},{value:"Response",id:"response-4",level:3},{value:"Example Response",id:"example-response-3",level:3},{value:"Replay Captured Request",id:"replay-captured-request",level:2},{value:"Request",id:"request-5",level:3},{value:"Parameters",id:"parameters-2",level:3},{value:"Example Request",id:"example-request-1",level:3},{value:"Response",id:"response-5",level:3},{value:"Delete Captured Requests",id:"delete-captured-requests",level:2},{value:"Request",id:"request-6",level:3},{value:"Response",id:"response-6",level:3},{value:"Captured Request Detail",id:"captured-request-detail",level:2},{value:"Request",id:"request-7",level:3},{value:"Response",id:"response-7",level:3},{value:"Example Response",id:"example-response-4",level:3}],u={toc:o},d="wrapper";function c(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"ngrok-agent-api"},"ngrok Agent API"),(0,r.kt)("hr",null),(0,r.kt)("p",null,"The ngrok agent exposes an HTTP API that grants programmatic access to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Collect status and metrics information"),(0,r.kt)("li",{parentName:"ul"},"Collect and replay captured requests"),(0,r.kt)("li",{parentName:"ul"},"Start and stop tunnels dynamically")),(0,r.kt)("h2",{id:"base-url-and-authentication"},"Base URL and Authentication"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Base URL"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"http://127.0.0.1:4040/api"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Authentication"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"None"))))),(0,r.kt)("p",null,"The ngrok agent API is exposed as part of ngrok's local web inspection interface. Because it is served on a local interface, the API has no authentication. The Base URL will change if you override ",(0,r.kt)("inlineCode",{parentName:"p"},"web_addr")," in your configuration file."),(0,r.kt)("h3",{id:"access-the-root-api-resource-of-a-running-ngrok-agent"},"Access the root API resource of a running ngrok agent"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"curl http://localhost:4040/api/\n")),(0,r.kt)("h2",{id:"supported-content-types"},"Supported Content Types"),(0,r.kt)("p",null,"Request parameters must be encoded to the API using ",(0,r.kt)("inlineCode",{parentName:"p"},"application/json"),". Ensure that your client sets the request's ",(0,r.kt)("inlineCode",{parentName:"p"},"Content-Type")," header appropriately. All responses returned by the API are ",(0,r.kt)("inlineCode",{parentName:"p"},"application/json"),"."),(0,r.kt)("h2",{id:"versioning-and-api-stability"},"Versioning and API Stability"),(0,r.kt)("p",null,"The ngrok agent API guarantees that breaking changes to the API will never be made unless the caller explicitly opts in to a newer version. The mechanism by which a caller opts into a new version of the API will be determined in the future when it becomes necessary. Examples of non-breaking changes to the API that will not be opt-in include the following."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The addition of new resources"),(0,r.kt)("li",{parentName:"ul"},"The addition of new methods to existing resources"),(0,r.kt)("li",{parentName:"ul"},"The addition of new fields on existing resource representations"),(0,r.kt)("li",{parentName:"ul"},"Bug fixes which change the API to match documented behavior")),(0,r.kt)("h2",{id:"list-tunnels"},"List Tunnels"),(0,r.kt)("p",null,"Returns a list of running tunnels with status and metrics information."),(0,r.kt)("h3",{id:"request"},"Request"),(0,r.kt)("p",null,"GET/api/tunnels"),(0,r.kt)("h3",{id:"response"},"Response"),(0,r.kt)("h3",{id:"parameters"},"Parameters"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tunnels")),(0,r.kt)("td",{parentName:"tr",align:null},"list of all running tunnels. See the ",(0,r.kt)("a",{parentName:"td",href:"#tunnel-detail"},"Tunnel detail")," resource for docs on the parameters of each tunnel object")))),(0,r.kt)("h3",{id:"example-response"},"Example Response"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "tunnels": [\n      {\n          "name": "command_line",\n          "uri": "/api/tunnels/command_line",\n          "public_url": "https://d95211d2.ngrok.io",\n          "proto": "https",\n          "config": {\n              "addr": "localhost:80",\n              "inspect": true,\n          },\n          "metrics": {\n              "conns": {\n                  "count": 0,\n                  "gauge": 0,\n                  "rate1": 0,\n                  "rate5": 0,\n                  "rate15": 0,\n                  "p50": 0,\n                  "p90": 0,\n                  "p95": 0,\n                  "p99": 0\n              },\n              "http": {\n                  "count": 0,\n                  "rate1": 0,\n                  "rate5": 0,\n                  "rate15": 0,\n                  "p50": 0,\n                  "p90": 0,\n                  "p95": 0,\n                  "p99": 0\n              }\n          }\n      },\n      ...\n  ],\n  "uri": "/api/tunnels"\n}\n')),(0,r.kt)("h2",{id:"start-tunnel"},"Start tunnel"),(0,r.kt)("p",null,"Dynamically starts a new tunnel on the ngrok agent. The request body parameters are the same as those you would use to define the tunnel in the configuration file."),(0,r.kt)("h3",{id:"request-1"},"Request"),(0,r.kt)("p",null,"POST/api/tunnels"),(0,r.kt)("h3",{id:"parameters-1"},"Parameters"),(0,r.kt)("p",null,"Parameter names and behaviors are identical to those those defined in the configuration file. Use the ",(0,r.kt)("a",{parentName:"p",href:"/secure-tunnels/ngrok-agent/reference/config#tunnel-definitions"},"tunnel definitions")," section as a reference for configuration parameters and their behaviors."),(0,r.kt)("h3",{id:"example-request-body"},"Example request body"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "addr": "22",\n  "proto": "tcp",\n  "name": "ssh"\n}\n')),(0,r.kt)("h3",{id:"response-1"},"Response"),(0,r.kt)("p",null,"201 status code with a response body describing the started tunnel. See the ",(0,r.kt)("a",{parentName:"p",href:"#tunnel-detail"},"Tunnel detail")," resource for docs on the parameters of the response object"),(0,r.kt)("h3",{id:"example-response-1"},"Example Response"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "name": "",\n  "uri": "/api/tunnels/",\n  "public_url": "tcp://0.tcp.ngrok.io:53476",\n  "proto": "tcp",\n  "config": {\n      "addr": "localhost:22",\n      "inspect": false,\n  },\n  "metrics": {\n      "conns": {\n          "count": 0,\n          "gauge": 0,\n          "rate1": 0,\n          "rate5": 0,\n          "rate15": 0,\n          "p50": 0,\n          "p90": 0,\n          "p95": 0,\n          "p99": 0\n      },\n      "http": {\n          "count": 0,\n          "rate1": 0,\n          "rate5": 0,\n          "rate15": 0,\n          "p50": 0,\n          "p90": 0,\n          "p95": 0,\n          "p99": 0\n      }\n  }\n}\n')),(0,r.kt)("h2",{id:"tunnel-detail"},"Tunnel detail"),(0,r.kt)("p",null,"Get status and metrics about the named running tunnel"),(0,r.kt)("h3",{id:"request-2"},"Request"),(0,r.kt)("p",null,"GET/api/tunnels/:name"),(0,r.kt)("h3",{id:"response-2"},"Response"),(0,r.kt)("h3",{id:"example-response-2"},"Example Response"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "name": "command_line",\n  "uri": "/api/tunnels/command_line",\n  "public_url": "https://ac294125.ngrok.io",\n  "proto": "https",\n  "config": {\n      "addr": "localhost:80",\n      "inspect": true,\n  },\n  "metrics": {\n      "conns": {\n          "count": 0,\n          "gauge": 0,\n          "rate1": 0,\n          "rate5": 0,\n          "rate15": 0,\n          "p50": 0,\n          "p90": 0,\n          "p95": 0,\n          "p99": 0\n      },\n      "http": {\n          "count": 0,\n          "rate1": 0,\n          "rate5": 0,\n          "rate15": 0,\n          "p50": 0,\n          "p90": 0,\n          "p95": 0,\n          "p99": 0\n      }\n  }\n}\n')),(0,r.kt)("h2",{id:"stop-tunnel"},"Stop tunnel"),(0,r.kt)("p",null,"Stop a running tunnel"),(0,r.kt)("h3",{id:"request-3"},"Request"),(0,r.kt)("p",null,"DELETE/api/tunnels/:name"),(0,r.kt)("h3",{id:"response-3"},"Response"),(0,r.kt)("p",null,"204 status code with an empty body"),(0,r.kt)("h2",{id:"list-captured-requests"},"List Captured Requests"),(0,r.kt)("p",null,"Returns a list of all HTTP requests captured for inspection. This will only return requests that are still in memory (ngrok evicts captured requests when their memory usage exceeds ",(0,r.kt)("inlineCode",{parentName:"p"},"inspect_db_size"),")"),(0,r.kt)("h3",{id:"request-4"},"Request"),(0,r.kt)("p",null,"GET/api/requests/http"),(0,r.kt)("h3",{id:"query-parameters"},"Query Parameters"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"limit")),(0,r.kt)("td",{parentName:"tr",align:null},"maximum number of requests to return")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tunnel_name")),(0,r.kt)("td",{parentName:"tr",align:null},"filter requests only for the given tunnel name")))),(0,r.kt)("h3",{id:"example-request"},"Example Request"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"curl http://localhost:4040/api/requests/http?limit=50\n")),(0,r.kt)("h3",{id:"response-4"},"Response"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"requests")),(0,r.kt)("td",{parentName:"tr",align:null},"list of captured requests. See the ",(0,r.kt)("a",{parentName:"td",href:"#captured-request-detail"},"Captured Request Detail")," resource for docs on the request objects")))),(0,r.kt)("h3",{id:"example-response-3"},"Example Response"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "uri": "/api/requests/http",\n  "requests": [\n      {\n          "uri": "/api/requests/http/548fb5c700000002",\n          "id": "548fb5c700000002",\n          "tunnel_name": "command_line (http)",\n          "remote_addr": "192.168.100.25",\n          "start": "2014-12-15T20:32:07-08:00",\n          "duration": 3893202,\n          "request": {\n              "method": "GET",\n              "proto": "HTTP/1.1",\n              "headers": {\n                  "Accept": [\n                      "*/*"\n                  ],\n                  "Accept-Encoding": [\n                      "gzip, deflate, sdch"\n                  ],\n                  "Accept-Language": [\n                      "en-US,en;q=0.8"\n                  ],\n                  "Connection": [\n                      "keep-alive"\n                  ],\n                  "User-Agent": [\n                      "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36"\n                  ],\n                  "X-Original-Host": [\n                      "c159663f.ngrok.io"\n                  ]\n              },\n              "uri": "/favicon.ico",\n              "raw": "<BASE64 ENCODED BYTES>"\n          },\n          "response": {\n              "status": "502 Bad Gateway",\n              "status_code": 502,\n              "proto": "HTTP/1.1",\n              "headers": {\n                  "Content-Length": [\n                      "1716"\n                  ]\n              },\n              "raw": "<BASE64 ENCODED BYTES>",\n          }\n      },\n      ...\n  ]\n}\n')),(0,r.kt)("h2",{id:"replay-captured-request"},"Replay Captured Request"),(0,r.kt)("p",null,"Replays a request against the local endpoint of a tunnel"),(0,r.kt)("h3",{id:"request-5"},"Request"),(0,r.kt)("p",null,"POST/api/requests/http"),(0,r.kt)("h3",{id:"parameters-2"},"Parameters"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"id")),(0,r.kt)("td",{parentName:"tr",align:null},"id of request to replay")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tunnel_name")),(0,r.kt)("td",{parentName:"tr",align:null},"name of the tunnel to play the request against. If unspecified, the request is played against the same tunnel it was recorded on")))),(0,r.kt)("h3",{id:"example-request-1"},"Example Request"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'curl -H "Content-Type: application/json" -d \'{"id": "548fb5c700000002"}\' http://localhost:4040/api/requests/http\n')),(0,r.kt)("h3",{id:"response-5"},"Response"),(0,r.kt)("p",null,"204 status code with an empty body"),(0,r.kt)("h2",{id:"delete-captured-requests"},"Delete Captured Requests"),(0,r.kt)("p",null,"Deletes all captured requests"),(0,r.kt)("h3",{id:"request-6"},"Request"),(0,r.kt)("p",null,"DELETE/api/requests/http"),(0,r.kt)("h3",{id:"response-6"},"Response"),(0,r.kt)("p",null,"204 status code with no response body"),(0,r.kt)("h2",{id:"captured-request-detail"},"Captured Request Detail"),(0,r.kt)("p",null,"Returns metadata and raw bytes of a captured request. The raw data is base64-encoded in the JSON response. The ",(0,r.kt)("inlineCode",{parentName:"p"},"response")," value maybe ",(0,r.kt)("inlineCode",{parentName:"p"},"null")," if the local server has not yet responded to a request."),(0,r.kt)("h3",{id:"request-7"},"Request"),(0,r.kt)("p",null,"GET/api/requests/http/:request_id"),(0,r.kt)("h3",{id:"response-7"},"Response"),(0,r.kt)("h3",{id:"example-response-4"},"Example Response"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "uri": "/api/requests/http/548fb5c700000002",\n  "id": "548fb5c700000002",\n  "tunnel_name": "command_line (http)",\n  "remote_addr": "192.168.100.25",\n  "start": "2014-12-15T20:32:07-08:00",\n  "duration": 3893202,\n  "request": {\n      "method": "GET",\n      "proto": "HTTP/1.1",\n      "headers": {\n          "Accept": [\n              "*/*"\n          ],\n          "Accept-Encoding": [\n              "gzip, deflate, sdch"\n          ],\n          "Accept-Language": [\n              "en-US,en;q=0.8"\n          ],\n          "Connection": [\n              "keep-alive"\n          ],\n          "User-Agent": [\n              "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36"\n          ],\n          "X-Original-Host": [\n              "c159663f.ngrok.io"\n          ]\n      },\n      "uri": "/favicon.ico",\n      "raw": "<BASE64 ENCODED BYTES>"\n  },\n  "response": {\n      "status": "502 Bad Gateway",\n      "status_code": 502,\n      "proto": "HTTP/1.1",\n      "headers": {\n          "Content-Length": [\n              "1716"\n          ]\n      },\n      "raw": "<BASE64 ENCODED BYTES>",\n  }\n}\n')))}c.isMDXComponent=!0}}]);