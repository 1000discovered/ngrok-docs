"use strict";(self.webpackChunkngrok_doc=self.webpackChunkngrok_doc||[]).push([[46157],{79060:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var n=a(51163),i=(a(59496),a(49613));const r={description:"Use Microsoft Azure AD to secure access to ngrok tunnels"},o="Azure Active Directory SSO (SAML)",l={unversionedId:"integrations/azure-ad/sso-saml",id:"integrations/azure-ad/sso-saml",title:"Azure Active Directory SSO (SAML)",description:"Use Microsoft Azure AD to secure access to ngrok tunnels",source:"@site/docs/integrations/azure-ad/sso-saml.md",sourceDirName:"integrations/azure-ad",slug:"/integrations/azure-ad/sso-saml",permalink:"/docs/integrations/azure-ad/sso-saml",draft:!1,editUrl:"https://github.com/ngrok/ngrok-docs/edit/main/docs/integrations/azure-ad/sso-saml.md",tags:[],version:"current",lastUpdatedBy:"Russ Savage",lastUpdatedAt:1693002758,formattedLastUpdatedAt:"Aug 25, 2023",frontMatter:{description:"Use Microsoft Azure AD to secure access to ngrok tunnels"},sidebar:"docs",previous:{title:"Azure AD",permalink:"/docs/integrations/azure-ad/"},next:{title:"Azure AD B2C",permalink:"/docs/integrations/azure-ad-b2c/"}},p={},s=[{value:"Requirements",id:"requirements",level:2},{value:"Step 1: Create an ngrok Edge",id:"create-edge",level:2},{value:"Step 2: Create an Azure AD application",id:"create-app",level:2},{value:"Step 3: Update the ngrok Edge with the IdP metadata",id:"update-ngrok-edge",level:2},{value:"Step 4: Test the integration",id:"test-integration",level:2},{value:"Bonus: Configure ngrok to enforce authorization based on Azure groups",id:"bonus",level:2}],g={toc:s},c="wrapper";function m(e){let{components:t,...r}=e;return(0,i.kt)(c,(0,n.Z)({},g,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"azure-active-directory-sso-saml"},"Azure Active Directory SSO (SAML)"),(0,i.kt)("hr",null),(0,i.kt)("admonition",{title:"TL;DR",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"To have ngrok enforce Single Sign-On using SAML with Azure Active Directory (Azure AD):"),(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"#create-edge"},"Create an ngrok Edge")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"#create-app"},"Create an Azure AD application")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"#update-ngrok-edge"},"Update the ngrok Edge with the IdP metadata")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"#test-integration"},"Test your integration")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"#bonus"},"Bonus: configure ngrok to enforce authorization based on Azure groups")))),(0,i.kt)("p",null,"This article details how to configure Azure AD as an Identity Provider for your ngrok Edge. By integrating Azure AD with ngrok, you can:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Restrict access to ngrok tunnels to only users who authenticated via Azure AD"),(0,i.kt)("li",{parentName:"ul"},"Configure Azure AD and ngrok to enforce user and group authorization"),(0,i.kt)("li",{parentName:"ul"},"Use Azure AD's dashboard to facilitate access to ngrok applications")),(0,i.kt)("h2",{id:"requirements"},"Requirements"),(0,i.kt)("p",null,"To configure ngrok tunnels with Azure AD, you must have:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"an ",(0,i.kt)("a",{parentName:"li",href:"https://ngrok.com/pricing"},"ngrok Enterprise Account")," with an authtoken or admin access to configure edges with SAML"),(0,i.kt)("li",{parentName:"ul"},"a Microsoft Azure account with access to an Azure AD tenant")),(0,i.kt)("h2",{id:"create-edge"},"Step 1: Create an ngrok Edge"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Go to the ",(0,i.kt)("a",{parentName:"p",href:"https://dashboard.ngrok.com"},"ngrok dashboard"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click ",(0,i.kt)("strong",{parentName:"p"},"Cloud Edge")," > ",(0,i.kt)("strong",{parentName:"p"},"Edges"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create an Edge:"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("strong",{parentName:"li"},"New Edge")),(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("strong",{parentName:"li"},"HTTPS Edge")),(0,i.kt)("li",{parentName:"ol"},"Click the ",(0,i.kt)("strong",{parentName:"li"},"Pencil Icon"),' next to "no description". Enter ',(0,i.kt)("em",{parentName:"li"},"Edge With Azure Active Directory SSO")," as the Edge name and click ",(0,i.kt)("strong",{parentName:"li"},"Save")))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Configure the SAML module for this Edge:"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"On the Routes section, click ",(0,i.kt)("strong",{parentName:"li"},"SAML")),(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Begin setup")),(0,i.kt)("li",{parentName:"ol"},"In the Identity Provider section, copy the following XML as a placeholder into the input box")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<EntityDescriptor xmlns="urn:oasis:names:tc:SAML:2.0:metadata"></EntityDescriptor>\n')),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/1-3.png",src:a(70463).Z,width:"1916",height:"2244"})),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click ",(0,i.kt)("strong",{parentName:"p"},"Save"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Note that ngrok has now generated values for the fields in the Service Provider section. You will need to configure Azure AD with these values later"))))),(0,i.kt)("h2",{id:"create-app"},"Step 2: Create an Azure AD application"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Go to your ",(0,i.kt)("a",{parentName:"p",href:"https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/Overview"},"Azure AD tenant in Azure"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create an enterprise application"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Starting from the sidebar, in the Manage section, click ",(0,i.kt)("strong",{parentName:"li"},"Enterprise Applications")," > ",(0,i.kt)("strong",{parentName:"li"},"New application")),(0,i.kt)("li",{parentName:"ol"},"Give your application a name (eg ",(0,i.kt)("inlineCode",{parentName:"li"},"www")," for a website client). Click ",(0,i.kt)("strong",{parentName:"li"},"Create"))),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/2-2.png",src:a(5346).Z,width:"1920",height:"1006"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To assign users/groups for this application, in the Getting Started section, click ",(0,i.kt)("strong",{parentName:"p"},"1. Assign users and groups")," > ",(0,i.kt)("strong",{parentName:"p"},"Add user/group"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Set up single sign on with SAML"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"In the Getting Started section, click on the box titled ",(0,i.kt)("strong",{parentName:"li"},"2. Set up single sign on")," > ",(0,i.kt)("strong",{parentName:"li"},"SAML")),(0,i.kt)("li",{parentName:"ol"},"Configure SAML. In the Basic SAML Configuration box click ",(0,i.kt)("strong",{parentName:"li"},"Edit"))),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/2-4.png",src:a(10282).Z,width:"1910",height:"2188"})),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Add Identifier (Entity ID) and Reply URL (Assertion Consumer Service URL) values using the previously the ngrok generated Entity ID and ACS URL")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/2-4b.png",src:a(87809).Z,width:"1912",height:"2190"})),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Save")),(0,i.kt)("li",{parentName:"ol"},"Download the Metadata XML. In the SAML Certificates box > Token signing certificate section > click ",(0,i.kt)("strong",{parentName:"li"},"Download")," for the Federation Metadata XML")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/2-4c.png",src:a(41140).Z,width:"1914",height:"2182"})))),(0,i.kt)("h2",{id:"update-ngrok-edge"},"Step 3: Update the ngrok Edge with the IdP metadata"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Back in the ngrok dashboard for your Edge's SAML configuration, upload the XML file generated by Azure AD"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/3-1.png",src:a(66240).Z,width:"1918",height:"2188"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click ",(0,i.kt)("strong",{parentName:"p"},"Save")))),(0,i.kt)("h2",{id:"test-integration"},"Step 4: Test the integration"),(0,i.kt)("admonition",{title:"Note",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"For this step, we assume you have an app running locally (i.e. on localhost:3000) with the ngrok client installed.")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Launch a tunnel connected to your configured Edge")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"On your Edge's page, in the Routes section, click ",(0,i.kt)("strong",{parentName:"p"},"Start a tunnel")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/4-1.png",src:a(17700).Z,width:"1922",height:"2188"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Copy the tunnel command"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/4-1b.png",src:a(64584).Z,width:"1916",height:"2190"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Launch a terminal and paste the command, replacing ",(0,i.kt)("inlineCode",{parentName:"p"},"http://localhost:80")," with your local web app address (e.g., ",(0,i.kt)("inlineCode",{parentName:"p"},"http://localhost:3000"),")")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Hit ",(0,i.kt)("strong",{parentName:"p"},"Enter")," to launch the tunnel")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Confirm that the tunnel is connected to your edge"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Return to the ngrok dashboard"),(0,i.kt)("li",{parentName:"ol"},"Close the ",(0,i.kt)("strong",{parentName:"li"},"Start a tunnel")," and the ",(0,i.kt)("strong",{parentName:"li"},"Tunnel group")," drawers"),(0,i.kt)("li",{parentName:"ol"},"Refresh the Edge page"),(0,i.kt)("li",{parentName:"ol"},"In the Routes section > Traffic section you will see the message ",(0,i.kt)("em",{parentName:"li"},"You have 1 tunnel online. Start additional tunnels to begin load balancing."))),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/4-2.png",src:a(46450).Z,width:"1922",height:"2186"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Copy the ngrok url on the Endpoints section")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Access your Edge application"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"In your browser, launch an incognito window"),(0,i.kt)("li",{parentName:"ol"},"Access your ngrok tunnel via your copied URL"),(0,i.kt)("li",{parentName:"ol"},"You should be prompted to log in with your Microsoft credentials"),(0,i.kt)("li",{parentName:"ol"},"After login, you should be able to see the application")))),(0,i.kt)("h2",{id:"bonus"},"Bonus: Configure ngrok to enforce authorization based on Azure groups"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"In Azure, configure the SAML response to include group claims. In the Attributes & Claims box click ",(0,i.kt)("strong",{parentName:"p"},"Edit")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/5-1.png",src:a(47870).Z,width:"1916",height:"2184"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click ",(0,i.kt)("strong",{parentName:"p"},"Add a group claim")," > ",(0,i.kt)("strong",{parentName:"p"},"Advanced options")," > Customize the name of the group claim")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Set the name of the group claim to ",(0,i.kt)("inlineCode",{parentName:"p"},"groups"),". This specific value is required for ngrok"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/5-3.png",src:a(24993).Z,width:"1920",height:"2182"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click ",(0,i.kt)("strong",{parentName:"p"},"Save"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Go to your group page and copy the object Id (Azure AD returns group object Ids in the group claim)"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/5-5.png",src:a(8447).Z,width:"1912",height:"2188"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Configure ngrok to enforce group authorization. In ngrok on your Edge's page, in the Authorization section, update the groups input with your Azure group object Id (NOT group name) values"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"img/5-6.png",src:a(91672).Z,width:"1918",height:"2190"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Access your Edge application"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"In your browser, launch an incognito window"),(0,i.kt)("li",{parentName:"ol"},"Access your ngrok tunnel via your copied URL"),(0,i.kt)("li",{parentName:"ol"},"You should be prompted to log in with your Microsoft credentials"),(0,i.kt)("li",{parentName:"ol"},"Only users assigned to the authorized groups will have access to the application")))))}m.isMDXComponent=!0},70463:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/1-3-6bd04556024699a2ee588a548aeb25c2.png"},5346:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/2-2-5a80bcb85180eb2b8d2c775ae2c40b4c.png"},10282:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/2-4-730073179cba9c6879aef9040a46a687.png"},87809:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/2-4b-40003350f5bed1756d5b56e0c9e61764.png"},41140:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/2-4c-3c14bb89533a4ebd25c6b1da83fbc51b.png"},66240:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/3-1-ee3468d8a0f34cc6ea732fabae0951d7.png"},17700:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/4-1-c3a9ba5aa1691ab6ea2faaedee2e43a9.png"},64584:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/4-1b-afc1232a220ddf7bb3588ce83d97d00e.png"},46450:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/4-2-54fe841af54124952ecb7663247b517c.png"},47870:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/5-1-5e8dc76747823e95b0704e7dacd44761.png"},24993:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/5-3-9ae67a0e7443b9ff4b173208706a3434.png"},8447:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/5-5-976046d055364652937f8aa5e7937eee.png"},91672:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/5-6-2de2be4cf0ac194297502de7ad4f9e33.png"}}]);